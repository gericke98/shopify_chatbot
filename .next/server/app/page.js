(()=>{var e={};e.id=931,e.ids=[931],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5315:e=>{"use strict";e.exports=require("path")},7360:e=>{"use strict";e.exports=require("url")},7648:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>o.a,__next_app__:()=>f,originalPathname:()=>u,pages:()=>l,routeModule:()=>p,tree:()=>c}),r(4617),r(1506),r(5866);var a=r(3191),n=r(8716),i=r(7922),o=r.n(i),s=r(5231),d={};for(let e in s)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>s[e]);r.d(t,d);let c=["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,4617)),"/Users/santiagogerickeparga/Desktop/AI/my-shopify-chatbot/app/page.tsx"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,7481))).default(e)],apple:[async e=>(await Promise.resolve().then(r.bind(r,8544))).default(e)],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,1506)),"/Users/santiagogerickeparga/Desktop/AI/my-shopify-chatbot/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,5866,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,7481))).default(e)],apple:[async e=>(await Promise.resolve().then(r.bind(r,8544))).default(e)],openGraph:[],twitter:[],manifest:void 0}}],l=["/Users/santiagogerickeparga/Desktop/AI/my-shopify-chatbot/app/page.tsx"],u="/page",f={require:r,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},5439:(e,t,r)=>{let a={c9f233a648c5b83f8eca6a896a84aeaf251abf95:()=>Promise.resolve().then(r.bind(r,4617)).then(e=>e.default),"18dc6842b27857fc00e736899371bc1de6c24856":()=>Promise.resolve().then(r.bind(r,2922)).then(e=>e.updateTicketWithOrderInfo),"1fb07ad077892b49c60c1bc36d057f385d68439a":()=>Promise.resolve().then(r.bind(r,2922)).then(e=>e.addMessageToTicket),"473566c5d74e57705d82f03ad3b0e57406af7346":()=>Promise.resolve().then(r.bind(r,2922)).then(e=>e.createTicket),"697dc994124abcf2c6ec89c78cef4a9cc8c945bd":()=>Promise.resolve().then(r.bind(r,2922)).then(e=>e.getMessages),a403c6e152d273cd4129829b40121d867d84a92e:()=>Promise.resolve().then(r.bind(r,2922)).then(e=>e.getTicket),ecfe0da7a0de2be4cc8d3774fdd0076ebe12f0a1:()=>Promise.resolve().then(r.bind(r,2922)).then(e=>e.getTickets),fa8db310c55fd570653f2384872df781204a75c8:()=>Promise.resolve().then(r.bind(r,2922)).then(e=>e.updateTicketAdmin)};async function n(e,...t){return(await a[e]()).apply(null,t)}e.exports={c9f233a648c5b83f8eca6a896a84aeaf251abf95:n.bind(null,"c9f233a648c5b83f8eca6a896a84aeaf251abf95"),"18dc6842b27857fc00e736899371bc1de6c24856":n.bind(null,"18dc6842b27857fc00e736899371bc1de6c24856"),"1fb07ad077892b49c60c1bc36d057f385d68439a":n.bind(null,"1fb07ad077892b49c60c1bc36d057f385d68439a"),"473566c5d74e57705d82f03ad3b0e57406af7346":n.bind(null,"473566c5d74e57705d82f03ad3b0e57406af7346"),"697dc994124abcf2c6ec89c78cef4a9cc8c945bd":n.bind(null,"697dc994124abcf2c6ec89c78cef4a9cc8c945bd"),a403c6e152d273cd4129829b40121d867d84a92e:n.bind(null,"a403c6e152d273cd4129829b40121d867d84a92e"),ecfe0da7a0de2be4cc8d3774fdd0076ebe12f0a1:n.bind(null,"ecfe0da7a0de2be4cc8d3774fdd0076ebe12f0a1"),fa8db310c55fd570653f2384872df781204a75c8:n.bind(null,"fa8db310c55fd570653f2384872df781204a75c8")}},4125:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,2994,23)),Promise.resolve().then(r.t.bind(r,6114,23)),Promise.resolve().then(r.t.bind(r,9727,23)),Promise.resolve().then(r.t.bind(r,9671,23)),Promise.resolve().then(r.t.bind(r,1868,23)),Promise.resolve().then(r.t.bind(r,4759,23))},4902:()=>{},5303:()=>{},2922:(e,t,r)=>{"use strict";r.r(t),r.d(t,{addMessageToTicket:()=>$,createTicket:()=>N,getMessages:()=>j,getTicket:()=>x,getTickets:()=>A,updateTicketAdmin:()=>C,updateTicketWithOrderInfo:()=>D});var a={};r.r(a),r.d(a,{messages:()=>m,messagesRelations:()=>g,tickets:()=>f,ticketsRelations:()=>p});var n=r(4330);r(166);var i=r(2237),o=r(9110),s=r(1613),d=r(443),c=r(2140),l=r(8748),u=r(5961);let f=(0,d.af)("tickets",{id:(0,c.fL)("id").primaryKey().notNull(),orderNumber:(0,c.fL)("order_number"),email:(0,c.fL)("email"),name:(0,c.fL)("name"),createdAt:(0,c.fL)("created_at").notNull(),updatedAt:(0,c.fL)("updated_at").notNull(),status:(0,c.fL)("status").notNull(),admin:(0,l.O7)("admin").notNull().default(!1)}),p=(0,s.lE)(f,({many:e})=>({messages:e(m)})),m=(0,d.af)("messages",{id:(0,u.eP)("id").primaryKey().notNull(),sender:(0,c.fL)("sender").notNull(),content:(0,c.fL)("content").notNull(),timestamp:(0,c.fL)("timestamp").notNull(),ticketId:(0,c.fL)("ticket_id").references(()=>f.id,{onDelete:"cascade"})}),g=(0,s.lE)(m,({one:e})=>({ticket:e(f,{fields:[m.ticketId],references:[f.id]})})),b=(0,i.qn)(process.env.DATABASE_URL),h=(0,o.tS)(b,{schema:a});var y=r(7745),v=r(7708),R=r(7410),w=r(618);class k extends Error{constructor(e,t){super(e),this.originalError=t,this.name="DatabaseError"}}class I extends Error{constructor(e){super(e),this.name="ValidationError"}}let O=new Map;function S(e){let t=Date.now(),r=O.get(e);return!r||t-r.timestamp>6e4?(O.set(e,{count:1,timestamp:t}),!0):!(r.count>=20)&&(r.count+=1,!0)}let P=e=>{let t=new Date(e);return t.toLocaleDateString()+" "+t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},T=R.z.string().uuid({message:"Invalid ticket ID format. Must be a valid UUID."}),E=R.z.object({sender:R.z.enum(["user","bot","admin"],{message:"Sender must be 'user', 'bot', or 'admin'"}),content:R.z.string().min(1,"Message content cannot be empty"),timestamp:R.z.string().optional()}),_=R.z.object({first_name:R.z.string().optional(),last_name:R.z.string().optional()}).optional();async function A(){console.log("[ACTION] Getting all tickets");try{return await h.query.tickets.findMany()}catch(e){throw console.error("[ERROR] Failed to get tickets:",e),new k("Failed to retrieve tickets",e)}}async function x(e){try{let t=T.parse(e);return console.log(`[ACTION] Getting ticket with ID: ${t}`),await h.query.tickets.findFirst({where:(0,y.eq)(f.id,t)})}catch(t){if(t instanceof R.z.ZodError)throw console.error(`[VALIDATION ERROR] Invalid ticket ID: ${e}`,t.errors),new I(`Invalid ticket ID: ${t.errors[0].message}`);throw console.error(`[ERROR] Failed to get ticket ${e}:`,t),new k(`Failed to retrieve ticket with ID ${e}`,t)}}async function j(e){try{let t=T.parse(e);return console.log(`[ACTION] Getting messages for ticket ID: ${t}`),await h.query.messages.findMany({where:(0,y.eq)(m.ticketId,t)})}catch(t){if(t instanceof R.z.ZodError)throw console.error(`[VALIDATION ERROR] Invalid ticket ID: ${e}`,t.errors),new I(`Invalid ticket ID: ${t.errors[0].message}`);throw console.error(`[ERROR] Failed to get messages for ticket ${e}:`,t),new k(`Failed to retrieve messages for ticket ID ${e}`,t)}}async function N(e){console.log("[ACTION] Creating new ticket");try{let t=E.parse(e);if(!S("create-ticket"))return console.warn("[RATE LIMIT] Create ticket request rate limited"),{status:429,error:"Too many requests. Please try again later."};let r=crypto.randomUUID(),a=await h.insert(f).values({id:r,orderNumber:null,email:null,status:"open",createdAt:P(new Date().toISOString()),updatedAt:P(new Date().toISOString()),admin:!1}).returning();return await h.insert(m).values({sender:t.sender,content:t.content,timestamp:P(new Date().toISOString()),ticketId:r}),console.log(`[SUCCESS] Created ticket with ID: ${r}`),{status:200,data:a[0]}}catch(e){if(e instanceof R.z.ZodError)return console.error("[VALIDATION ERROR] Invalid message data:",e.errors),{status:400,error:`Invalid message data: ${e.errors[0].message}`};return console.error("[ERROR] Failed to create ticket:",e),{status:500,error:"Failed to create ticket"}}}async function D(e,t,r,a){console.log(`[ACTION] Updating ticket ${e} with order info`);try{let n=T.parse(e),i=R.z.string().min(1).parse(t),o=R.z.string().email().parse(r),s=_.parse(a);if(!await h.query.tickets.findFirst({where:(0,y.eq)(f.id,n)}))return{status:404,error:"Ticket not found"};let d=await h.update(f).set({orderNumber:i,email:o,name:s?`${s.first_name||""} ${s.last_name||""}`.trim():null,updatedAt:P(new Date().toISOString())}).where((0,y.eq)(f.id,n)).returning();return(0,v.revalidatePath)("/"),console.log(`[SUCCESS] Updated ticket ${n} with order info`),{status:200,data:d[0]}}catch(t){if(t instanceof R.z.ZodError)return console.error(`[VALIDATION ERROR] Invalid data for ticket ${e}:`,t.errors),{status:400,error:`Validation error: ${t.errors[0].message}`};return console.error(`[ERROR] Failed to update ticket ${e} with order info:`,t),{status:500,error:"Failed to update ticket with order information"}}}async function C(e,t){console.log(`[ACTION] Updating admin status for ticket ${e} to ${t}`);try{let r=T.parse(e),a=R.z.boolean().parse(t);if(!await h.query.tickets.findFirst({where:(0,y.eq)(f.id,r)}))return{status:404,error:"Ticket not found"};let n=await h.update(f).set({admin:a,updatedAt:P(new Date().toISOString())}).where((0,y.eq)(f.id,r)).returning();return(0,v.revalidatePath)("/"),console.log(`[SUCCESS] Updated admin status for ticket ${r} to ${a}`),{status:200,data:n[0]}}catch(t){if(t instanceof R.z.ZodError)return console.error(`[VALIDATION ERROR] Invalid data for ticket ${e}:`,t.errors),{status:400,error:`Validation error: ${t.errors[0].message}`};return console.error(`[ERROR] Failed to update admin status for ticket ${e}:`,t),{status:500,error:"Failed to update ticket admin status"}}}async function $(e,t){console.log(`[ACTION] Adding message to ticket ${e}`);try{if(!e)throw new I("Ticket ID is required");let r=T.parse(e),a=E.parse(t),n=`message-${r}`;if(!S(n))return console.warn(`[RATE LIMIT] Add message request rate limited for ticket ${r}`),{status:429,error:"Too many requests. Please try again later."};if(!await h.query.tickets.findFirst({where:(0,y.eq)(f.id,r)}))return{status:404,error:"Ticket not found"};return await h.insert(m).values({sender:a.sender,content:a.content,timestamp:P(new Date().toISOString()),ticketId:r}),await h.update(f).set({updatedAt:P(new Date().toISOString())}).where((0,y.eq)(f.id,r)),(0,v.revalidatePath)("/"),console.log(`[SUCCESS] Added message to ticket ${r}`),{status:200,success:!0}}catch(t){if(t instanceof I)return console.error(`[VALIDATION ERROR] ${t.message}`),{status:400,error:t.message};if(t instanceof R.z.ZodError)return console.error("[VALIDATION ERROR] Invalid message data:",t.errors),{status:400,error:`Invalid message data: ${t.errors[0].message}`};return console.error(`[ERROR] Failed to add message to ticket ${e}:`,t),{status:500,error:"Failed to add message to ticket"}}}(0,w.h)([A,x,j,N,D,C,$]),(0,n.j)("ecfe0da7a0de2be4cc8d3774fdd0076ebe12f0a1",A),(0,n.j)("a403c6e152d273cd4129829b40121d867d84a92e",x),(0,n.j)("697dc994124abcf2c6ec89c78cef4a9cc8c945bd",j),(0,n.j)("473566c5d74e57705d82f03ad3b0e57406af7346",N),(0,n.j)("18dc6842b27857fc00e736899371bc1de6c24856",D),(0,n.j)("fa8db310c55fd570653f2384872df781204a75c8",C),(0,n.j)("1fb07ad077892b49c60c1bc36d057f385d68439a",$)},1506:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c,metadata:()=>d});var a=r(9510),n=r(8215),i=r.n(n),o=r(623),s=r.n(o);r(7272);let d={title:"Shameless Collective | Customer Support",description:"Get help from our customer support assistant",icons:{icon:"/favicon.ico"}};function c({children:e}){return a.jsx("html",{lang:"en",children:a.jsx("body",{className:`${i().variable} ${s().variable} antialiased font-sans`,children:a.jsx("main",{className:"min-h-screen bg-gradient-to-b from-gray-50 to-gray-100",children:e})})})}},4617:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});var a=r(9510),n=r(4330);r(166);var i=r(1085),o=r(2922);async function s(){console.log("Home page loaded");let e=await (0,o.createTicket)({sender:"bot",content:"\uD83D\uDC4B Hi! I'm Santi from Shameless Collective. What can I help you with?",timestamp:new Date().toISOString()});return console.log("Ticket:",e),200===e.status&&"data"in e&&e.data?.id&&(0,i.redirect)(`/${e.data.id}`),a.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:(0,a.jsxs)("div",{className:"text-center p-8",children:[a.jsx("h1",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Creating your support session..."}),a.jsx("p",{className:"text-gray-600",children:"Please wait while we set up your chat."})]})})}(0,r(618).h)([s]),(0,n.j)("c9f233a648c5b83f8eca6a896a84aeaf251abf95",s)},1085:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{ReadonlyURLSearchParams:function(){return o},RedirectType:function(){return a.RedirectType},notFound:function(){return n.notFound},permanentRedirect:function(){return a.permanentRedirect},redirect:function(){return a.redirect}});let a=r(3953),n=r(6399);class i extends Error{constructor(){super("Method unavailable on `ReadonlyURLSearchParams`. Read more: https://nextjs.org/docs/app/api-reference/functions/use-search-params#updating-searchparams")}}class o extends URLSearchParams{append(){throw new i}delete(){throw new i}set(){throw new i}sort(){throw new i}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},6399:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{isNotFoundError:function(){return n},notFound:function(){return a}});let r="NEXT_NOT_FOUND";function a(){let e=Error(r);throw e.digest=r,e}function n(e){return"object"==typeof e&&null!==e&&"digest"in e&&e.digest===r}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},4397:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RedirectStatusCode",{enumerable:!0,get:function(){return r}}),function(e){e[e.SeeOther=303]="SeeOther",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.PermanentRedirect=308]="PermanentRedirect"}(r||(r={})),("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},3953:(e,t,r)=>{"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{RedirectType:function(){return a},getRedirectError:function(){return d},getRedirectStatusCodeFromError:function(){return m},getRedirectTypeFromError:function(){return p},getURLFromRedirectError:function(){return f},isRedirectError:function(){return u},permanentRedirect:function(){return l},redirect:function(){return c}});let n=r(4580),i=r(2934),o=r(4397),s="NEXT_REDIRECT";function d(e,t,r){void 0===r&&(r=o.RedirectStatusCode.TemporaryRedirect);let a=Error(s);a.digest=s+";"+t+";"+e+";"+r+";";let i=n.requestAsyncStorage.getStore();return i&&(a.mutableCookies=i.mutableCookies),a}function c(e,t){void 0===t&&(t="replace");let r=i.actionAsyncStorage.getStore();throw d(e,t,(null==r?void 0:r.isAction)?o.RedirectStatusCode.SeeOther:o.RedirectStatusCode.TemporaryRedirect)}function l(e,t){void 0===t&&(t="replace");let r=i.actionAsyncStorage.getStore();throw d(e,t,(null==r?void 0:r.isAction)?o.RedirectStatusCode.SeeOther:o.RedirectStatusCode.PermanentRedirect)}function u(e){if("object"!=typeof e||null===e||!("digest"in e)||"string"!=typeof e.digest)return!1;let[t,r,a,n]=e.digest.split(";",4),i=Number(n);return t===s&&("replace"===r||"push"===r)&&"string"==typeof a&&!isNaN(i)&&i in o.RedirectStatusCode}function f(e){return u(e)?e.digest.split(";",3)[2]:null}function p(e){if(!u(e))throw Error("Not a redirect error");return e.digest.split(";",2)[1]}function m(e){if(!u(e))throw Error("Not a redirect error");return Number(e.digest.split(";",4)[3])}(function(e){e.push="push",e.replace="replace"})(a||(a={})),("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},8544:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});var a=r(6621);let n=e=>[{type:"image/png",sizes:"180x180",url:(0,a.fillMetadataSegment)(".",e.params,"apple-icon.png")+"?bd6aa6b6333bda42"}]},7481:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});var a=r(6621);let n=e=>[{type:"image/x-icon",sizes:"48x48",url:(0,a.fillMetadataSegment)(".",e.params,"favicon.ico")+""}]},7272:()=>{}};var t=require("../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[948,428,520,621],()=>r(7648));module.exports=a})();